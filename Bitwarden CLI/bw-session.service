[Unit]
Description=unlock Bitwarden vault
After=bw-login.service
Requires=bw-login.service

[Service]
Type=oneshot
RemainAfterExit=yes
LoadCredentialEncrypted=bw-password:%E/Bitwarden\ CLI/password
Environment=PASSWORD_STORE_DIR="%E/Bitwarden CLI"
ExecStart=/bin/bash -c 'bw unlock --raw --passwordfile="%d/bw-password" | pass insert -mf session-key'
ExecStop=/usr/bin/bw lock

[Install]
WantedBy=default.target
