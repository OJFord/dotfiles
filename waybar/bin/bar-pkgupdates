#!/bin/bash
set -eEu
set -o pipefail

function Check() {
    pac=$(checkupdates | wc -l)
    aur=$(yay -Qua | wc -l)

    check=$((pac + aur))
    if [ "$check" != "0" ]; then
        echo "$pac;$aur"
    fi
}

function Open() {
    alacritty \
        -o window.class.general=bar-term \
        -o window.class.instance=bar-term \
        -o window.dimensions.columns=60 \
        -o window.dimensions.lines=12 \
        -o window.position.x=150 \
        -o window.position.y=30 \
        -e /bin/sh -c "yay -Qu; yay -Syu; kill --signal USR1 '$PPID'"
}

case "${1:-}" in
    --open)
        Open
        exit 0
        ;;
    *)
        Check
        exit 0
        ;;
esac
